/*
 * jQuery dateDropDowns
 *
 * url		http://http://www.amdonnelly.co.uk/things/date-drop-down-lists.aspx
 * author	Alan Donnelly 2011
 * version	1.0.2
 * license	MIT and GPL licenses
 */
(function(e){e.fn.dateDropDowns=function(t){var n={dateFormat:"dd-mm-yy",monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],yearStart:"1900",yearEnd:(new Date).getFullYear(),defaultCurrentDate:false};var t=e.extend(n,t);return this.each(function(){function c(){if(a.length>0){var e=n.dateFormat.split(l);var t=a.split(l);var r=new Date;for(_x=0;_x<t.length;_x++){if(e[_x].toLowerCase().indexOf("d")>-1){r.setDate(t[_x])}else if(e[_x].toLowerCase().indexOf("m")>-1){r.setMonth(t[_x]-1)}else if(e[_x].toLowerCase().indexOf("y")>-1){r.setYear(t[_x])}}f=r}}function h(){var r=n.dateFormat.split(l);var a=t;t.replaceWith("<div id='"+i+"' class='dateLists_container'></div>");for(_x=0;_x<r.length;_x++){if(r[_x].toLowerCase().indexOf("d")>-1){e("#"+i).append("<div id='"+s+"' class='day_container'>");e("#"+s).append("<select id='"+s+"_list' name='"+s+"_list' class='list'></select>");e("#"+i).append("</div>")}else if(r[_x].toLowerCase().indexOf("m")>-1){e("#"+i).append("<div id='"+o+"' class='month_container'>");e("#"+o).append("<select id='"+o+"_list' name='"+o+"_list' class='list'></select>");e("#"+i).append("</div>")}else if(r[_x].toLowerCase().indexOf("y")>-1){e("#"+i).append("<div id='"+u+"' class='year_container'>");e("#"+u).append("<select id='"+u+"_list' name='"+u+"_list' class='list'></select>");e("#"+i).append("</div>")}}e("#"+i).append(a);t.hide()}function p(){d();m();g()}function d(){var t=f.getMonth()+1;var r="";var i=1;_daysInMonth=v(t,f.getFullYear())+1;if(e("#"+s+"_list").children().length<_daysInMonth){i=e("#"+s+"_list").children().length+1}else{e("#"+s+"_list").children().remove()}for(_x=i;_x<_daysInMonth;_x++){var o=n.defaultCurrentDate&&f.getDate()==_x?"selected='true'":"";r+="<option value='"+_x+"' "+o+">"+_x+"</option>"}e("#"+s+"_list").append(r)}function v(e,t){var n=31;if(e==4||e==6||e==9||e==11){n=30}else if(e==2){if(t%4==0){n=29}else{n=28}}return n}function m(){e("#"+o+"_list").children().remove();for(_x=0;_x<12;_x++){var t=n.defaultCurrentDate&&f.getMonth()==_x?"selected='true'":"";e("#"+o+"_list").append("<option value='"+_x+"' "+t+">"+n.monthNames[_x]+"</option>")}}function g(){e("#"+u+"_list").children().remove();var t=parseInt(n.yearStart);var r=parseInt(n.yearEnd);if(r>t){for(_x=t;_x<r+1;_x++){var i=n.defaultCurrentDate&&f.getFullYear()==_x?"selected='true'":"";e("#"+u+"_list").append("<option value='"+_x+"' "+i+">"+_x+"</option>")}}else{for(_y=t;_y>2005;_y--){var i=f.getFullYear()==_y?"selected='true'":"";e("#"+u+"_list").append("<option value='"+_y+"' "+i+">"+_y+"</option>")}}}function y(){e("#"+s+"_list").change(function(){f.setDate(e("#"+s+"_list").val());b()});e("#"+o+"_list").change(function(){var t=parseInt(e("#"+o+"_list").val());var n=f.getDate();_daysInMonth=v(t+1,f.getFullYear());if(n>_daysInMonth){n=_daysInMonth}var r=new Date(f.getFullYear(),t,n,0,0,0,0);f=r;d();b()});e("#"+u+"_list").change(function(){var t=e("#"+u+"_list").val();var n=f.getDate();var r=f.getMonth();_daysInMonth=v(r+1,t);if(n>_daysInMonth){n=_daysInMonth}var i=new Date(t,r,n,0,0,0,0);f=i;d();b()})}function b(){var e=f.getDate();var r=f.getMonth()+1;var i=f.getFullYear();var s=n.dateFormat;if(s.indexOf("DD")>-1&&e.toString().length<2){e="0"+e}if(s.indexOf("MM")>-1&&r.toString().length<2){r="0"+r}var o=n.dateFormat.toLowerCase();o=o.replace("dd",e);o=o.replace("mm",r);o=o.replace("yy",i);t.val(o)}var t=e(this);var r=t.html();var i=t.attr("id")+"_dateLists";var s=i+"_day";var o=i+"_month";var u=i+"_year";var a=t.val();var f=new Date;var l=n.dateFormat.indexOf("/")>-1?"/":n.dateFormat.indexOf(".")>-1?".":"-";c();h();p();y()})}})(jQuery);